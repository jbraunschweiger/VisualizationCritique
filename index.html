<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/bootstrap.min.css" >
    <link rel="stylesheet" href="style.css" >
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <title>Assignment 0</title>
</head>
<body>
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">
          <img src="https://upload.wikimedia.org/wikipedia/en/thumb/d/d7/WashU_St._Louis_seal.svg/1200px-WashU_St._Louis_seal.svg.png" width="30" height="30" class="d-inline-block align-top" alt="" loading="lazy">
          CSE 457 Assignment 0
        </a>
      </nav>

    <div>

    <div id="mainContainer" class="container">
        <h1>Successful Visualization</h1>
        <div class="row">
            <div class="col-lg">
                <img src="simulation.png" width="100%"/>
                <p>Screenshot of an animation. <a href="https://wustl.edu/about/campuses/danforth-campus/">Link</a> to the original.</p>
            </div>
            <div class="col-lg">
                <ul class="list-group content">
                    <li>Hello, world!</li>
                </ul>
            </div>
        </div>
        <h1>Unsuccessful Visualization</h1>
        <div class="row">
            <div class="col-lg">
                <img src="app.jpeg" class="padding" width="100%"/>
                <p>Screenshot an interactive visualization. <a href="https://coronavirus.app/map">Link</a> to the original.</p>
            </div>
            <div class="col-lg">
                <ul class="list-group content">
                </ul>
            </div>
        </div>
        <h1>Redesigned Visualization</h1>
        <div class="row">
            <div class="col-lg">
                <svg id="svg" width="500" height="350"></svg>
                <p>Created following tutorials chapter 14 of <a href="https://learning.oreilly.com/library/view/interactive-data-visualization/9781491921296/ch14.html#geomapping_chapter">the textbook</a> and <a href="https://bl.ocks.org/wboykinm/dbbe50d1023f90d4e241712395c27fb3">online</a>.</p>
                <p>Data Sources: <a href="https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json">US States SVG</a> | <a href="https://github.com/nytimes/covid-19-data/blob/master/live/us-states.csv">State Covid Data</a> | <a href="https://github.com/COVID19Tracking/associated-data/blob/master/us_census_data/us_census_2018_population_estimates_states.csv">State Population Data</a></p>
            </div>
            <div class="col-lg">
                <ul class="list-group content">
                </ul>
            </div>
        </div>
    </div>

    <br>

    <div class="footer">
        <p>ðŸŽ“ Jakob Braunschweiger</p>
    </div>

    <script src="js/dom-example.js"></script>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script>
        
        var lowColor = '#ffdddd'
        var highColor = '#b30000'
        // The svg
        var svg = d3.select("svg"),
          width = +svg.attr("width"),
          height = +svg.attr("height");
        
        var projection = d3.geoAlbersUsa()
                .translate([5*width/8, height/2])    // translate to center of screen
                .scale([500]);          // scale things down so see entire US
    
        var path = d3.geoPath()               // path generator that will convert GeoJSON to SVG paths
            .projection(projection);  // tell path generator to use albersUsa projection   
        

        d3.csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/live/us-states.csv", function(data) {
            var minCases = 0;
            var maxCases = 800000;
            console.log(minCases);
            var color = d3.scaleLinear().domain([
                minCases,
                maxCases
            ]).range([lowColor,highColor]);

            d3.json("https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json", function(json) {
                for (var i = 0; i < data.length; i++) {
                    var dataState = data[i].state;

                    //Grab data value, and convert from string to float
                    var dataValue = parseFloat(data[i].cases);

                    //Find the corresponding state inside the GeoJSON
                    for (var j = 0; j < json.features.length; j++) {
                        var jsonState = json.features[j].properties.name;

                        if (dataState == jsonState) {

                            //Copy the data value into the JSON
                            json.features[j].properties.value = dataValue;

                            //Stop looking through the JSON
                            break;

                        }
                    }
                }
                svg.selectAll("path")
                    .data(json.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .style("fill", function(d) {
                        //Get data value
                        var value = d.properties.value;

                        if (value) {
                            //If value existsâ€¦
                            return color(value);
                        } else {
                            //If value is undefinedâ€¦
                            return "#ccc";
                        }
                    });

                // Add Legend https://bl.ocks.org/wboykinm/dbbe50d1023f90d4e241712395c27fb3
                var w = 130, h = 140;

                var key = d3.select("svg")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h)
                    .attr("class", "legend");

                var legend = key.append("defs")
                    .append("svg:linearGradient")
                    .attr("id", "gradient")
                    .attr("x1", "100%")
                    .attr("y1", "0%")
                    .attr("x2", "100%")
                    .attr("y2", "100%")
                    .attr("spreadMethod", "pad");

                legend.append("stop")
                    .attr("offset", "0%")
                    .attr("stop-color", highColor)
                    .attr("stop-opacity", 1);
                    
                legend.append("stop")
                    .attr("offset", "100%")
                    .attr("stop-color", lowColor)
                    .attr("stop-opacity", 1);

                key.append("rect")
                    .attr("width", w - 100)
                    .attr("height", h)
                    .style("fill", "url(#gradient)")
                    .attr("transform", "translate(0,10)");

                var y = d3.scaleLinear()
                    .range([h, 0])
                    .domain([minCases, maxCases]);

                var yAxis = d3.axisRight(y);

                key.append("g")
                    .attr("class", "y axis")
                    .attr("transform", "translate(41,10)")
                    .call(yAxis)
            });
        });
        
        </script>
</body>
</html>